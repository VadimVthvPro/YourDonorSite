#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–µ–∂–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ssh root@178.172.212.221 "bash -s" < check_fresh_errors.sh

set -e

echo "========================================="
echo "üîç –°–í–ï–ñ–ò–ï –û–®–ò–ë–ö–ò –í –õ–û–ì–ê–•"
echo "========================================="

# –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ –∏ –∂–¥—ë–º –Ω–æ–≤—ã—Ö
echo "" > /var/log/tvoydonor-api.err.log
sleep 2

echo "–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã. –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:"
echo "1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞"
echo "2. –û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫—Ä–æ–≤–∏"
echo ""
echo "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥—ë—Ç–µ –æ—à–∏–±–∫—É..."
read

echo ""
echo "========================================="
echo "üìã –ü–û–°–õ–ï–î–ù–ò–ï –û–®–ò–ë–ö–ò:"
echo "========================================="
tail -100 /var/log/tvoydonor-api.err.log

echo ""
echo "========================================="
echo "üîç –ü–û–ò–°–ö UndefinedColumn:"
echo "========================================="
tail -200 /var/log/tvoydonor-api.err.log | grep -B 5 "UndefinedColumn\|does not exist" | tail -30

echo ""
echo "========================================="
echo "‚úÖ –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê"
echo "========================================="
