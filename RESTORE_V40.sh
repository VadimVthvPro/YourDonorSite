#!/bin/bash

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ðŸ”„ Ð’ÐžÐ¡Ð¡Ð¢ÐÐÐžÐ’Ð›Ð•ÐÐ˜Ð• v40 (ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ¯Ð¯ Ð ÐÐ‘ÐžÐ§ÐÐ¯ Ð’Ð•Ð Ð¡Ð˜Ð¯)"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ðŸ“‹ Ð§Ð¢Ðž Ð‘Ð£Ð”Ð•Ð¢ Ð¡Ð”Ð•Ð›ÐÐÐž:"
echo "  âœ… Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· v40 (git checkout b224631)"
echo "  âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€:"
echo "     â€¢ website/js/auth.js (Ð‘Ð•Ð— Ð°Ð²Ñ‚Ð¾Ð²Ñ…Ð¾Ð´Ð°)"
echo "     â€¢ website/js/app.js (Ð‘Ð•Ð— Ð°Ð²Ñ‚Ð¾Ð²Ñ…Ð¾Ð´Ð°)"
echo "     â€¢ website/index.html (Ð‘Ð•Ð— auth-storage.js)"
echo "  âœ… ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ config.js"
echo "  âœ… ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Nginx"
echo ""
read -p "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ? (y/n): " confirm
if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
    echo "âŒ ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾"
    exit 0
fi

cd /Users/VadimVthv/Your_donor

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ“¤ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¸Ð· v40"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

scp website/js/auth.js root@178.172.212.221:/opt/tvoydonor/website/js/
scp website/js/app.js root@178.172.212.221:/opt/tvoydonor/website/js/
scp website/index.html root@178.172.212.221:/opt/tvoydonor/website/

echo "âœ… Ð¤Ð°Ð¹Ð»Ñ‹ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ”§ ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ config.js"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

ssh root@178.172.212.221 '
cd /opt/tvoydonor/website/js
TIMESTAMP=$(date +%s)

cat > config.js << "CONFIGEOF"
/**
 * Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
 */

// API URL
const hostname = window.location.hostname;
const protocol = window.location.protocol;

if (hostname === "localhost" || hostname === "127.0.0.1") {
    window.API_URL = "http://localhost:5001/api";
} else {
    window.API_URL = protocol + "//" + hostname + ":5001/api";
}

// Ð’ÐµÑ€ÑÐ¸Ñ Ð´Ð»Ñ cache busting
window.VERSION = "VERSIONPLACEHOLDER";

console.log("ðŸ”§ Config Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, API_URL:", window.API_URL);
CONFIGEOF

sed -i "s/VERSIONPLACEHOLDER/${TIMESTAMP}/" config.js
echo "âœ… config.js Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½! Ð’ÐµÑ€ÑÐ¸Ñ: ${TIMESTAMP}"
'

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Nginx"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

ssh root@178.172.212.221 '
nginx -t && systemctl reload nginx
echo "âœ… Nginx Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½"
'

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… Ð’ÐžÐ¡Ð¡Ð¢ÐÐÐžÐ’Ð›Ð•ÐÐ˜Ð• v40 Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐž!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ðŸ§ª ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ:"
echo "  1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: https://tvoydonor.by/"
echo "  2. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ: Cmd+Shift+R (Ð¶Ñ‘ÑÑ‚ÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ)"
echo "  3. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ: F12 â†’ Console"
echo ""
echo "âœ… Ð”Ð¾Ð»Ð¶Ð½Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ:"
echo "  ðŸ”§ Config Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½, API_URL: https://tvoydonor.by:5001/api"
echo "  ==== app.js Ð—ÐÐ“Ð Ð£Ð–Ð•Ð ===="
echo "  ðŸ” auth.js Ð—ÐÐ“Ð Ð£Ð–Ð•Ð"
echo ""
echo "âœ… Ð¡Ð°Ð¹Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ:"
echo "  â€¢ ÐšÑ€Ð°ÑÐ¸Ð²Ñ‹Ð¹ Ð´Ð¸Ð·Ð°Ð¹Ð½ (Ð²ÑÐµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð½Ð° Ð¼ÐµÑÑ‚Ðµ)"
echo "  â€¢ Ð’Ñ…Ð¾Ð´/Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚"
echo "  â€¢ Ð’Ñ‹Ð±Ð¾Ñ€ Ð¾Ð±Ð»Ð°ÑÑ‚Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
echo "  â€¢ Ð’ÑÐµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ñ€ÐµÐ°Ð³Ð¸Ñ€ÑƒÑŽÑ‚"
echo ""
echo "âš ï¸  Ð’ÐÐ–ÐÐž: ÐÐ²Ñ‚Ð¾Ð²Ñ…Ð¾Ð´ ÐžÐ¢ÐšÐ›Ð®Ð§ÐÐ (ÐºÐ°Ðº Ð² v40)"
echo "  â€¢ ÐŸÑ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ð¸ ÑÐ°Ð¹Ñ‚Ð° Ð½ÑƒÐ¶Ð½Ð¾ Ð²Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð·Ð°Ð½Ð¾Ð²Ð¾"
echo "  â€¢ Ð­Ñ‚Ð¾ Ñ†ÐµÐ½Ð° ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑÐ°Ð¹Ñ‚Ð°"
echo ""
