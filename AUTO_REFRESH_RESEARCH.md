# üîÑ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï: –ê–í–¢–û–û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• –ë–ï–ó –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ò

## üìã –ü–†–û–ë–õ–ï–ú–ê

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5 / Cmd+R) —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- ‚úÖ –î–æ–Ω–æ—Ä –æ—Ç–∫–ª–∏–∫–Ω—É–ª—Å—è –Ω–∞ –∑–∞–ø—Ä–æ—Å (–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ)
- ‚ùå –ú–µ–¥—Ü–µ–Ω—Ç—Ä –Ω–µ –≤–∏–¥–∏—Ç –æ—Ç–∫–ª–∏–∫ (–Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ) - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
- ‚ùå –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

---

## üîç –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î

### 1. Polling —É–∂–µ –ß–ê–°–¢–ò–ß–ù–û —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `messenger.js`:

```javascript
// –°—Ç—Ä–æ–∫–∏ 552-585
async checkForUpdates() {
    if (!this.isPolling) return;
    
    try {
        const updates = await MessengerAPI.getUpdates(this.lastMessageId);
        
        if (updates.new_messages && updates.new_messages.length > 0) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            for (const msg of updates.new_messages) {
                // ...
            }
        }
        
        if (updates.unread_counts) {
            this.updateUnreadCounts(updates.unread_counts);
        }
        
        // –ü–æ–≤—Ç–æ—Ä—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => this.checkForUpdates(), 3000);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ polling:', error);
    }
}
```

**–ù–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞!**

---

## üéØ –†–ï–®–ï–ù–ò–ï: –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨ POLLING –î–õ–Ø –í–°–ï–• –†–ê–ó–î–ï–õ–û–í

### –ß—Ç–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

#### **–î–ª—è –î–æ–Ω–æ—Ä–∞:**
1. **–ó–∞–ø—Ä–æ—Å—ã –∫—Ä–æ–≤–∏** (`/api/blood-requests`) - –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (`/api/stats/donor`) - –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
3. **–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä** (`/api/messages/updates`) - —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)

#### **–î–ª—è –ú–µ–¥—Ü–µ–Ω—Ç—Ä–∞:**
1. **–û—Ç–∫–ª–∏–∫–∏ –¥–æ–Ω–æ—Ä–æ–≤** (`/api/medical-center/donation-responses`) - –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
2. **–ó–∞–ø—Ä–æ—Å—ã –∫—Ä–æ–≤–∏** (`/api/medical-center/blood-requests`) - –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (`/api/stats/medcenter`) - –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
4. **–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä** (`/api/messages/updates`) - —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥)

---

## üö® –†–ò–°–ö–ò –ò –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

### ‚ùå –ù–ï–î–û–ü–£–°–¢–ò–ú–û:
1. **–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –º–æ–≥—É—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
2. **–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ—Ç–∫—Ä—ã—Ç—ã–π –º–æ–¥–∞–ª, –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞)
3. **–ú–∏–≥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞** - —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–û–î–•–û–î:
1. **"–£–º–Ω–æ–µ" –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç–∞—Ä—ã–º–∏
2. **–û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–µ** - –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º badge "–ù–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã" –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
4. **Pause –Ω–∞ —Ñ–æ–∫—É—Å–µ** - –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç, –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç A: Short Polling (–ø—Ä–æ—â–µ)
```javascript
// –ö–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º API
setInterval(async () => {
    const newData = await fetch('/api/blood-requests');
    updateUI(newData);
}, 10000); // 10 —Å–µ–∫—É–Ω–¥
```

**–ü–ª—é—Å—ã:** –ü—Ä–æ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å  
**–ú–∏–Ω—É—Å—ã:** –õ–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç B: Long Polling (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ)
```javascript
// –î–µ—Ä–∂–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º, backend –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
async function poll() {
    const response = await fetch('/api/updates?last_id=' + lastId);
    updateUI(response);
    poll(); // –°—Ä–∞–∑—É —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å
}
```

**–ü–ª—é—Å—ã:** –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  
**–ú–∏–Ω—É—Å—ã:** –°–ª–æ–∂–Ω–µ–µ backend

### –í–∞—Ä–∏–∞–Ω—Ç C: WebSocket (–∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ —Å–ª–æ–∂–Ω–æ)
```javascript
const ws = new WebSocket('wss://tvoydonor.by/ws');
ws.onmessage = (event) => {
    const update = JSON.parse(event.data);
    updateUI(update);
};
```

**–ü–ª—é—Å—ã:** –†–µ–∞–ª-—Ç–∞–π–º, –º–∏–Ω–∏–º—É–º –Ω–∞–≥—Ä—É–∑–∫–∏  
**–ú–∏–Ω—É—Å—ã:** –ù—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ò—Å–ø–æ–ª—å–∑—É–µ–º –í–∞—Ä–∏–∞–Ω—Ç A (Short Polling) —Å "—É–º–Ω—ã–º–∏" –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏:**

1. **–ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∂–¥—ã–µ 5-30 —Å–µ–∫—É–Ω–¥ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–¥–µ–ª–∞)
2. **–ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - –Ω–µ –ª–æ–º–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
3. **–†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç WebSocket

---

## üìä –ü–†–ò–ú–ï–†–ù–´–ô –ü–õ–ê–ù

### –≠—Ç–∞–ø 1: –î–æ–±–∞–≤–∏—Ç—å polling –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫—Ä–æ–≤–∏
- –î–æ–Ω–æ—Ä: –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
- –ú–µ–¥—Ü–µ–Ω—Ç—Ä: –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Ç–∫–ª–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫

### –≠—Ç–∞–ø 2: –î–æ–±–∞–≤–∏—Ç—å polling –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫

### –≠—Ç–∞–ø 3: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å "—É–º–Ω—ã–µ" —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- "–£ –≤–∞—Å 3 –Ω–æ–≤—ã—Ö –æ—Ç–∫–ª–∏–∫–∞" –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ü–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –Ω—É–∂–Ω–æ:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –æ–Ω –≤—ã–¥–µ—Ä–∂–∏—Ç)
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Flask API –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–≥–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ backend –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## ü§î –í–û–ü–†–û–° –ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ

**–•–æ—Ç–∏—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ?**

–ï—Å–ª–∏ –î–ê:
- ‚úÖ –Ø –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –ë–ï–ó–û–ü–ê–°–ù–û
- ‚úÖ –ë–µ–∑ "—Ä–∞–∑–≤–∞–ª–∞ –≤ —Ç—Ä—É—Ö—É" –∫–∞–∫ —Å –∞–≤—Ç–æ–≤—Ö–æ–¥–æ–º
- ‚úÖ –° –ø–∞—É–∑–æ–π –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

–ï—Å–ª–∏ –ù–ï–¢ / –û–¢–õ–û–ñ–ò–¢–¨:
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å" —Å –∏–∫–æ–Ω–∫–æ–π –∫—Ä—É—Ç—è—â–µ–≥–æ—Å—è –∫—Ä—É–≥–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å

