#!/bin/bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –¢–û–ß–ù–´–• –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫ 500 —Å —Å–µ—Ä–≤–µ—Ä–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ssh root@178.172.212.221 "bash -s" < get_exact_error.sh

set -e

echo "========================================="
echo "üîç –¢–û–ß–ù–´–ï –õ–û–ì–ò –û–®–ò–ë–û–ö 500"
echo "========================================="

echo ""
echo "1Ô∏è‚É£ –û—á–∏—â–∞–µ–º –ª–æ–≥–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –æ—à–∏–±–∫—É..."
echo "" > /var/log/tvoydonor-api.err.log

echo "–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ —Å–¥–µ–ª–∞–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É 500:"
echo "- –û—Ç–∫—Ä–æ–π—Ç–µ —Å–ø–∏—Å–æ–∫ –æ—Ç–∫–ª–∏–∫–æ–≤"
echo "- –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫—Ä–æ–≤–∏"
echo ""
echo "–ù–∞–∂–º–∏—Ç–µ Enter –ü–û–°–õ–ï —Ç–æ–≥–æ –∫–∞–∫ —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É 500 –≤ –±—Ä–∞—É–∑–µ—Ä–µ..."
read

echo ""
echo "========================================="
echo "üìã –ü–û–õ–ù–´–ô TRACEBACK –û–®–ò–ë–ö–ò:"
echo "========================================="
tail -200 /var/log/tvoydonor-api.err.log

echo ""
echo "========================================="
echo "üéØ –ö–û–ù–ö–†–ï–¢–ù–ê–Ø –û–®–ò–ë–ö–ê –ë–î:"
echo "========================================="
tail -200 /var/log/tvoydonor-api.err.log | grep -A 2 "psycopg2.errors\|does not exist\|column\|relation" | tail -20

echo ""
echo "========================================="
echo "üìä –°–¢–†–£–ö–¢–£–†–ê –¢–ê–ë–õ–ò–¶–´ BLOOD_REQUESTS:"
echo "========================================="
export PGPASSWORD='u1oFnZALhyfpbtir08nH'
psql -U donor_user -h localhost your_donor -c "\d blood_requests"

echo ""
echo "========================================="
echo "üìä –°–¢–†–£–ö–¢–£–†–ê –¢–ê–ë–õ–ò–¶–´ DONATION_RESPONSES:"
echo "========================================="
psql -U donor_user -h localhost your_donor -c "\d donation_responses"

echo ""
echo "========================================="
echo "‚úÖ –í–°–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –°–û–ë–†–ê–ù–ê"
echo "========================================="
