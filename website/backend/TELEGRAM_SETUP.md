# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ó–∞–¥–∞—á–∞ 1: Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî –ó–ê–í–ï–†–®–ï–ù–ê ‚úÖ

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `send_urgent_notifications()`** –≤ `app.py`:
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫—Ä–æ–≤–∏ (`blood_requests`)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–æ–Ω–æ—Ä–∞–º –º–µ–¥—Ü–µ–Ω—Ç—Ä–∞ –ò –∏–∑ —Ä–∞–π–æ–Ω–∞
   - –ü–æ–¥—Å—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –°–ø–∏—Å–æ–∫ –¥–æ–Ω–æ—Ä–æ–≤ –±–µ–∑ Telegram

2. **–°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `blood_requests`** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫—Ä–æ–≤—å

3. **–°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `telegram_link_codes`** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

4. **–î–æ–±–∞–≤–ª–µ–Ω—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**:
   - `GET /api/donor/telegram/link-code` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞
   - `GET /api/donor/telegram/status` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏–≤—è–∑–∫–∏
   - `POST /api/donor/telegram/unlink` ‚Äî –æ—Ç–≤—è–∑–∫–∞ Telegram

5. **–û–±–Ω–æ–≤–ª—ë–Ω Telegram –±–æ—Ç** (`telegram_bot.py`):
   - –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/link –ö–û–î` –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
   - –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `/help` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î (–±—ã–ª–æ `donorbay`, —Å—Ç–∞–ª–æ `your_donor`)

---

## üì± –ö–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å Telegram (–¥–ª—è –¥–æ–Ω–æ—Ä–∞):

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Telegram –±–æ—Ç–∞**:
   ```bash
   cd /Users/VadimVthv/Your_donor/website/backend
   python3 telegram_bot.py
   ```

2. **–ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞** –≤ Telegram:
   - –¢–æ–∫–µ–Ω –±–æ—Ç–∞: `8212814214:AAG29mEQN2EWS1wFvKbDqC8nr6SgN3_VeZ8`
   - –ò–º—è –±–æ—Ç–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ https://t.me/BotFather

3. **–í Telegram –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É** `/start`

4. **–í–æ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç** –∫–∞–∫ –¥–æ–Ω–æ—Ä

5. **–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ** –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Telegram

6. **–ù–∞–∂–º–∏—Ç–µ** "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏"

7. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ** 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥

8. **–í Telegram –Ω–∞–ø–∏—à–∏—Ç–µ**: `/link 123456` (–≥–¥–µ 123456 ‚Äî –≤–∞—à –∫–æ–¥)

9. **–ì–æ—Ç–æ–≤–æ!** –ë–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç –ø—Ä–∏–≤—è–∑–∫—É


### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –ë–î (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```python
import psycopg2

conn = psycopg2.connect(
    host='localhost',
    database='your_donor',
    user='postgres',
    password='vadamahjkl'
)

cur = conn.cursor()

# –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ —Å–≤–æ–π Telegram ID! –£–∑–Ω–∞—Ç—å: /myid –≤ –±–æ—Ç–µ
YOUR_TELEGRAM_ID = 123456789

# –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ ID –≤–∞—à–µ–≥–æ –¥–æ–Ω–æ—Ä–∞ (–æ–±—ã—á–Ω–æ 1)
DONOR_ID = 1

cur.execute("""
    UPDATE users 
    SET telegram_id = %s,
        telegram_username = '–≤–∞—à_username',
        notify_urgent = TRUE,
        notify_low = TRUE
    WHERE id = %s
""", (YOUR_TELEGRAM_ID, DONOR_ID))

conn.commit()
print("‚úÖ Telegram –ø—Ä–∏–≤—è–∑–∞–Ω!")
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Telegram –±–æ—Ç–∞:
```bash
cd /Users/VadimVthv/Your_donor/website/backend
python3 telegram_bot.py &
```

### 2. –ü—Ä–∏–≤—è–∂–∏—Ç–µ —Å–≤–æ–π Telegram (—Å–º. –≤—ã—à–µ)

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–≤—è–∑–∫—É:
–í Telegram –±–æ—Ç—É –Ω–∞–ø–∏—à–∏—Ç–µ `/status`

### 4. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞:
- –í–æ–π–¥–∏—Ç–µ –≤ –º–µ–¥—Ü–µ–Ω—Ç—Ä –Ω–∞ —Å–∞–π—Ç–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ "–î–æ–Ω–æ—Ä—Å–∫–∏–π —Å–≤–µ—Ç–æ—Ñ–æ—Ä"
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°—Ä–æ—á–Ω–æ" (–∫—Ä–∞—Å–Ω–∞—è) –Ω–∞ –Ω—É–∂–Ω–æ–π –≥—Ä—É–ø–ø–µ –∫—Ä–æ–≤–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª Flask ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
  ```
  [TELEGRAM] –í—ã–∑–æ–≤ send_urgent_notifications: mc_id=1, blood_type=O+
  [TELEGRAM] –ù–∞–π–¥–µ–Ω–æ –¥–æ–Ω–æ—Ä–æ–≤ —Å –≥—Ä—É–ø–ø–æ–π O+: 1
  [TELEGRAM] ‚úì –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: –í–æ–π—Ç–µ—Ö–æ–≤–∏—á –í–∞–¥–∏–º –û–ª–µ–≥–æ–≤–∏—á (ID: –í–ê–®_ID)
  [TELEGRAM] –ò—Ç–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 1/1
  ```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram:
–í–∞–º –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üö® –°—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–∞ –∫—Ä–æ–≤—å!

ü©∏ –ì—Ä—É–ø–ø–∞: O+
üè• –ú–µ–¥—Ü–µ–Ω—Ç—Ä: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
üìç –ê–¥—Ä–µ—Å: [–∞–¥—Ä–µ—Å]

–û—Ç–∫–ª–∏–∫–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç–µ –¢–≤–æ–π –î–æ–Ω–æ—Ä –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–¥—Ü–µ–Ω—Ç—Ä–æ–º.
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º:

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. **Telegram ID –ø—Ä–∏–≤—è–∑–∞–Ω?**
   ```sql
   SELECT id, full_name, telegram_id FROM users WHERE id = 1;
   ```
   - –ï—Å–ª–∏ `telegram_id` = `NULL` ‚Üí –ø—Ä–∏–≤—è–∂–∏—Ç–µ

2. **–î–æ–Ω–æ—Ä –∏–º–µ–µ—Ç –Ω—É–∂–Ω—É—é –≥—Ä—É–ø–ø—É –∫—Ä–æ–≤–∏?**
   ```sql
   SELECT full_name, blood_type FROM users WHERE id = 1;
   ```

3. **–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω?**
   ```bash
   ps aux | grep telegram_bot.py
   ```

4. **–õ–æ–≥–∏ Flask –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—Ç–ø—Ä–∞–≤–∫—É?**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å Flask
   - –ò–∑–º–µ–Ω–∏—Ç–µ —Å–≤–µ—Ç–æ—Ñ–æ—Ä
   - –ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ `[TELEGRAM]`

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
   ```bash
   curl "https://api.telegram.org/bot8212814214:AAG29mEQN2EWS1wFvKbDqC8nr6SgN3_VeZ8/getMe"
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: "chat not found"

- –í—ã **–ù–ï** –Ω–∞–ø–∏—Å–∞–ª–∏ –±–æ—Ç—É `/start`
- Telegram ID —É–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω–æ
- –†–µ—à–µ–Ω–∏–µ: –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start`, –∑–∞—Ç–µ–º `/myid`

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:

- ‚úÖ –§—É–Ω–∫—Ü–∏—è `send_urgent_notifications()` –≤ backend
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫—Ä–æ–≤–∏ (`blood_requests`)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ Telegram –±–æ—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π `/link`
- ‚úÖ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–æ–≤ –ø—Ä–∏–≤—è–∑–∫–∏
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã `telegram_link_codes` –∏ `blood_requests`

## ‚è≥ –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å:

- ‚è≥ UI –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¥–æ–Ω–æ—Ä–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞
- ‚è≥ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫—Ä–æ–≤–∏ –≤ –º–µ–Ω—é –¥–æ–Ω–æ—Ä–∞
- ‚è≥ –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å

---

## üìû –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

- `/start` ‚Äî –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
- `/link –ö–û–î` ‚Äî –ü—Ä–∏–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç (–ö–û–î –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞)
- `/status` ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É
- `/myid` ‚Äî –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π Telegram ID
- `/help` ‚Äî –°–ø—Ä–∞–≤–∫–∞
- `/unsubscribe` ‚Äî –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
