#!/bin/bash
echo "========================================="
echo "üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê updateResponseStatus"
echo "========================================="

ssh root@178.172.212.221 << 'ENDSSH'

echo ""
echo "1Ô∏è‚É£ –û—á–∏—â–∞–µ–º –ª–æ–≥–∏ API..."
> /var/log/tvoydonor-api.err.log

echo ""
echo "=========================================
‚ö†Ô∏è  –í–û–°–ü–†–û–ò–ó–í–ï–î–ò–¢–ï –û–®–ò–ë–ö–£:
=========================================
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://tvoydonor.by –∫–∞–∫ –ú–ï–î–¶–ï–ù–¢–†
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª \"–û—Ç–∫–ª–∏–∫–∏\"
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ‚úì (–ü–û–î–¢–í–ï–†–î–ò–¢–¨) –Ω–∞ –ª—é–±–æ–º –æ—Ç–∫–ª–∏–∫–µ
4. –ù–∞–∂–º–∏—Ç–µ Enter –ó–î–ï–°–¨ –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏
=========================================
"

read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—à–∏–±–∫–∏..."

echo ""
echo "2Ô∏è‚É£ –ü–û–õ–ù–´–ô TRACEBACK:"
tail -100 /var/log/tvoydonor-api.err.log | grep -B 30 "update_response\|updateResponseStatus\|/api/responses"

echo ""
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç /api/responses –≤ app.py:"
grep -n "@app.route('/api/responses" /opt/tvoydonor/website/backend/app.py

echo ""
echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é update_response:"
grep -A 50 "def update_response" /opt/tvoydonor/website/backend/app.py | head -60

echo ""
echo "=========================================
‚úÖ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê
=========================================
"

ENDSSH
